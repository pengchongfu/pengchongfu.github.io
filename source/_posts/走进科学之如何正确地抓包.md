---
title: 走进科学之如何正确地抓包
date: 2016-04-26 15:58:24
tags: openwrt
---
话说在月初的某期“走进科学”上，阿里巴巴的安全专家给广大的无知观众演示了无良wifi的危害。

考虑到我自己也在用着某盘，所以想看看这个危害是如何实现的。

### 原理

通过各种手段窃听流量，过滤出流量中的某盘cookie，获得cookie之后添加到浏览器中恶意登陆

### 窃听流量

首先使用很多用户喜闻乐见的免费（v）代（p）理（n）来窃听流量，众所周知，免费代理的安全性很值得怀疑。

于是我在我自己搭建的ss服务器上窃听流量。

获取服务器的流量信息可以使用tcpdump命令，然后传送到本机的wireshark上就能实时查看了

`ssh root@yourhost tcpdump tcp -w - | wireshark -k -i -`

输入密码成功登陆之后，用chrome登陆某盘，在wireshark中添加过滤条件http.host=="pan.baidu.com"，这样可以将报文中某盘的报文过滤出来

点选cookie，右键->复制->值，就能将cookie复制下来，方便导入浏览器

### 添加到浏览器

推荐在chrome上安装Cookie Hacker这个插件，安装好之后，先在浏览器上用隐身窗口打开pan.baidu.com，这时某盘应该是未登陆状态。

打开插件，将cookie复制进去并确认，刷新页面，这时可以看到已经登陆上了，然后就能做想做的事了。

### 总结

因此总结下来有以下几点：
1. 自己搭建一个vpn
2. 将vpn账号好心地散布给周围的人，方便他人
3. 进行上述的步骤，并且完善过滤规则，更好地获取cookie信息并保存

（大雾），不对，应该是以下几点：
1. 某盘采用http而不是https，因此报文一经截获就是明文；
2. 验证方式过于简单，过于依赖cookie